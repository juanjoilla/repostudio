<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Acceso Administrador | Artes Luis Studio</title>
  <link rel="stylesheet" th:href="@{/css/login.css}" />
</head>
<body class="login-body">

  <!-- Fondo animado -->
  <div class="login-background">
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
  </div>

  <!-- Contenedor del formulario -->
  <div class="login-wrapper">
    <div class="login-box">
      <h2>Panel de Administración</h2>
      <p>Inicia sesión para gestionar tu contenido</p>
      <form id="loginForm">
        <div class="input-group">
          <input type="email" id="correo" name="correo" required>
          <label for="correo">Correo Electrónico</label>
        </div>
        <div class="input-group">
          <input type="password" id="password" name="password" required>
          <label for="password">Contraseña</label>
        </div>
        <button type="submit" class="btn-login">Ingresar</button>
      </form>
      <p id="loginMessage"></p>
      
      <!-- Enlaces adicionales -->
      <div class="login-links">
        <a th:href="@{/}" class="link-home">← Volver al inicio</a>
        <div class="mt-3">
          <small class="text-muted">
            Usuarios de prueba:<br>
            <strong>Cliente:</strong> maria@ejemplo.com / cliente123<br>
            <strong>Admin:</strong> admin@artesluis.com / admin123
          </small>
        </div>
        <div class="mt-2">
          <button onclick="demoLogin('maria@ejemplo.com', 'cliente123')" class="btn btn-sm btn-outline-primary">
            Login Rápido Cliente
          </button>
          <button onclick="demoLogin('admin@artesluis.com', 'admin123')" class="btn btn-sm btn-outline-secondary">
            Login Rápido Admin
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript -->         
  <script th:src="@{/js/artesluis.js}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const loginForm = document.getElementById('loginForm');
      const messageElement = document.getElementById('loginMessage');
      
      loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const correo = document.getElementById('correo').value;
        const password = document.getElementById('password').value;
        const submitBtn = loginForm.querySelector('button[type="submit"]');
        
        // Deshabilitar botón y mostrar loading
        submitBtn.disabled = true;
        submitBtn.textContent = 'Iniciando...';
        messageElement.textContent = '';
        
        // Enviar datos de login (usar endpoint API que devuelve JSON)
        fetch('/api/usuarios/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            correo: correo,
            password: password
          })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Error en la autenticación');
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            messageElement.style.color = 'green';
            messageElement.textContent = data.message || 'Inicio de sesión exitoso';
            
            // Guardar credenciales en sessionStorage para operaciones de admin
            sessionStorage.setItem('adminEmail', correo);
            sessionStorage.setItem('adminPassword', password);
            
            // Redirigir según el rol del usuario
            const rol = data.usuario?.rol || 'CLIENTE';
            let redirectUrl = '/';
            
            if (rol === 'ADMIN' || rol === 'MODERADOR') {
              redirectUrl = '/admin';
            } else if (rol === 'ARTISTA') {
              redirectUrl = '/portafolio';
            } else {
              redirectUrl = '/planes';
            }
            
            // Redirigir después de un breve delay
            setTimeout(() => {
              window.location.href = redirectUrl;
            }, 1000);
          } else {
            messageElement.style.color = 'red';
            messageElement.textContent = data.message || 'Credenciales incorrectas';
          }
        })
        .catch(error => {
          console.error('Error:', error);
          messageElement.style.color = 'red';
          messageElement.textContent = 'Error de conexión. Intenta de nuevo.';
        })
        .finally(() => {
          // Rehabilitar botón
          submitBtn.disabled = false;
          submitBtn.textContent = 'Ingresar';
        });
      });
    });
    
    // Función para login rápido de demo
    function demoLogin(correo, password) {
      document.getElementById('correo').value = correo;
      document.getElementById('password').value = password;
      document.getElementById('loginForm').dispatchEvent(new Event('submit'));
    }
  </script>
</body>
</html>